<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Car Rental Admin</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body { min-height: 100vh; display: flex; }
    .sidebar { width: 250px; background: #fff; border-right: 1px solid #ddd; }
    .sidebar .nav-link { color: #333; }
    .sidebar .nav-link.active { background: #000; color: #fff; }
    .content { flex-grow: 1; padding: 20px; }
    .hidden { display: none; }
    /* hide non-essential on small screens */
    @media (max-width: 768px) {
      .d-hide-sm { display: none !important; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav class="sidebar d-flex flex-column p-3">
    <h5>Drivee Admin</h5>
    <ul class="nav nav-pills flex-column mb-auto" id="menu">
      <li class="nav-item"><a href="#cars" class="nav-link active" data-target="cars">Manage Cars</a></li>
      <li><a href="#bookings" class="nav-link" data-target="bookings">Manage Bookings</a></li>
      <li><a href="#reports" class="nav-link" data-target="reports">Rental Reports</a></li>
    </ul>
  </nav>
  <!-- Main Content -->
  <div class="content">
    <!-- Manage Cars -->
    <section id="cars">
      <h3>Manage Cars</h3>
      <form id="carForm" class="row gy-2 gx-3 align-items-center mb-4">
        <input type="hidden" id="carId" />
        <div class="col-md-4">
          <label class="form-label">Image</label>
          <input type="file" id="carImage" class="form-control" accept="image/*" />
        </div>
        <div class="col-md-4"><label class="form-label">Model</label><input type="text" id="carModel" class="form-control" required /></div>
        <div class="col-md-4"><label class="form-label">Year</label><input type="number" id="carYear" class="form-control" required /></div>
        <div class="col-md-4"><label class="form-label">Passengers</label><input type="number" id="carPassengers" class="form-control" /></div>
        <div class="col-md-4"><label class="form-label">Price/Day</label><input type="number" id="carPrice" class="form-control" /></div>
        <div class="col-md-4"><label class="form-label">Available</label><select id="carAvailable" class="form-select"><option value="true">Yes</option><option value="false">No</option></select></div>
        <div class="col-md-4"><label class="form-label">Transmission</label><input type="text" id="carTrans" class="form-control" /></div>
        <div class="col-md-4"><label class="form-label">Fuel Type</label><input type="text" id="carFuel" class="form-control" /></div>
        <div class="col-md-4"><label class="form-label">Mileage</label><input type="text" id="carMileage" class="form-control" /></div>
        <div class="col-md-4"><label class="form-label">Features</label><input type="text" id="carFeatures" class="form-control" placeholder="comma-separated" /></div>
        <div class="col-md-4"><label class="form-label">Rating</label><input type="number" id="carRating" class="form-control" step="0.1" /></div>
        <div class="col-12"><button type="submit" class="btn btn-primary" id="saveCar">Save Car</button></div>
      </form>
      <table class="table table-striped">
        <thead><tr>
          <th>Image</th><th>Model</th><th class="d-hide-sm">Year</th><th class="d-hide-sm">Passengers</th><th>Price/Day</th><th>Available</th><th>Actions</th>
        </tr></thead>
        <tbody id="carsTable"></tbody>
      </table>
    </section>
    <!-- Manage Bookings -->
    <section id="bookings" class="hidden">
      <h3>Manage Bookings</h3>
      <div class="mb-4">
        <h5>Pending</h5><table class="table"><thead><tr><th>Booking#</th><th>Vehicle</th><th>Date</th><th>Status</th></tr></thead><tbody id="pendingTable"></tbody></table>
      </div>
      <div class="mb-4">
        <h5>Confirmed</h5><table class="table"><thead><tr><th>Booking#</th><th>Vehicle</th><th>Date</th><th>Status</th></tr></thead><tbody id="confirmedTable"></tbody></table>
      </div>
      <div>
        <h5>Cancelled</h5><table class="table"><thead><tr><th>Booking#</th><th>Vehicle</th><th>Date</th><th>Status</th></tr></thead><tbody id="cancelledTable"></tbody></table>
      </div>
    </section>
    <!-- Rental Reports -->
    <section id="reports" class="hidden">
      <h3>Rental Reports</h3>
      <div class="row">
        <div class="col-md-6 mb-3">
          <h5>Bookings Per Month</h5><ul id="bookingsPerMonth" class="list-group"></ul>
        </div>
        <div class="col-md-6">
          <h5>Peak Hours</h5><ul id="peakHours" class="list-group"></ul>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script>
    // Storage logic
    const STORAGE_KEY_CARS = 'cars';
    const STORAGE_KEY_BOOKINGS = 'bookings';
    const getCars = () => JSON.parse(localStorage.getItem(STORAGE_KEY_CARS) || '[]');
    const saveCars = cars => localStorage.setItem(STORAGE_KEY_CARS, JSON.stringify(cars));
    const getBookings = () => JSON.parse(localStorage.getItem(STORAGE_KEY_BOOKINGS) || '[]');
    const saveBookings = b => localStorage.setItem(STORAGE_KEY_BOOKINGS, JSON.stringify(b));

    // Helpers
    const formatPrice = p => `$${p}`;
    const parseFeatures = s => s.split(',').map(f => f.trim());

    // Generic renderTable
    const renderTable = (data, tbody, config) => {
      const frag = document.createDocumentFragment();
      data.forEach(item => {
        const tr = document.createElement('tr');
        config.columns.forEach(col => {
          const td = document.createElement('td');
          if (col.renderer) td.appendChild(col.renderer(item));
          else td.textContent = col.formatter ? col.formatter(item[col.key]) : item[col.key];
          if (col.hiddenOnMobile) td.classList.add('d-hide-sm');
          tr.appendChild(td);
        });
        frag.appendChild(tr);
      });
      tbody.innerHTML = '';
      tbody.appendChild(frag);
    };

    // Page-specific logic
    document.addEventListener('DOMContentLoaded', () => {
      // Navigation
      document.querySelectorAll('#menu .nav-link').forEach(a => {
        a.addEventListener('click', e => {
          e.preventDefault();
          document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
          document.getElementById(a.dataset.target).classList.remove('hidden');
          document.querySelectorAll('#menu .nav-link').forEach(n => n.classList.remove('active'));
          a.classList.add('active');
        });
      });

      // Manage Cars
      const carForm = document.getElementById('carForm');
      const carsTable = document.getElementById('carsTable');
      const loadCars = () => {
        const cars = getCars();
        renderTable(cars, carsTable, { columns: [
          { key: 'image', renderer: c => {
            const img = document.createElement('img'); img.src = c.image; img.width = 60; return img;
          }},
          { key: 'model' },
          { key: 'year', hiddenOnMobile: true },
          { key: 'passengers', hiddenOnMobile: true },
          { key: 'price', formatter: formatPrice },
          { key: 'available' },
          { renderer: c => {
              const btn = document.createElement('button'); btn.textContent = 'Delete';
              btn.className = 'btn btn-sm btn-danger';
              btn.onclick = () => { const cs = getCars().filter(x => x.id !== c.id); saveCars(cs); loadCars(); };
              return btn;
          }}
        ]});
      };
      loadCars();
      carForm.onsubmit = e => {
        e.preventDefault();
        const file = document.getElementById('carImage').files[0];
        const reader = new FileReader();
        reader.onload = () => {
          const cars = getCars();
          const id = Date.now();
          const newCar = { id, image: reader.result, model: carForm.carModel.value,
            year: carForm.carYear.value, passengers: carForm.carPassengers.value,
            price: carForm.carPrice.value, available: carForm.carAvailable.value,
            transmission: carForm.carTrans.value, fuel: carForm.carFuel.value,
            mileage: carForm.carMileage.value, features: parseFeatures(carForm.carFeatures.value),
            rating: carForm.carRating.value };
          cars.push(newCar); saveCars(cars); loadCars(); carForm.reset();
        };
        if (file) reader.readAsDataURL(file);
      };

      // Manage Bookings
      const pendingTable = document.getElementById('pendingTable');
      const confirmedTable = document.getElementById('confirmedTable');
      const cancelledTable = document.getElementById('cancelledTable');
      const loadBookings = () => {
        const bks = getBookings();
        ['pending','confirmed','cancelled'].forEach(status => {
          const list = bks.filter(b => b.status === status);
          const tbody = { pending: pendingTable, confirmed: confirmedTable, cancelled: cancelledTable }[status];
          renderTable(list, tbody, { columns: [
            { key: 'id' }, { key: 'vehicle' }, { key: 'date' },
            { renderer: b => {
              const sel = document.createElement('select'); sel.className = 'form-select form-select-sm';
              ['pending','confirmed','cancelled'].forEach(st => {
                const o = document.createElement('option'); o.value = st; o.textContent = st; sel.appendChild(o);
              }); sel.value = b.status;
              sel.onchange = () => { b.status = sel.value; saveBookings(bks); loadBookings(); };
              return sel;
            }}
          ]});
        });
      };
      loadBookings();

      // Rental Reports
      const listPerMonth = document.getElementById('bookingsPerMonth');
      const listPeakHours = document.getElementById('peakHours');
      const loadReports = () => {
        const bks = getBookings();
        // Bookings per month
        const byMonth = bks.reduce((acc, b) => {
          const m = new Date(b.date).toLocaleString('default', { month: 'short', year: 'numeric' });
          acc[m] = (acc[m] || 0) + 1; return acc;
        }, {});
        listPerMonth.innerHTML = '';
        Object.entries(byMonth).forEach(([m, c]) => {
          const li = document.createElement('li'); li.className = 'list-group-item'; li.textContent = `${m}: ${c}`; listPerMonth.append(li);
        });
        // Peak hours
        const hours = bks.reduce((acc,b) => {
          const h = new Date(b.date).getHours(); acc[h] = (acc[h]||0)+1; return acc;
        }, {});
        listPeakHours.innerHTML = '';
        Object.entries(hours).sort((a,b)=>b[1]-a[1]).slice(0,5).forEach(([h,c]) => {
          const li = document.createElement('li'); li.className='list-group-item'; li.textContent=`${h}:00 - ${c}`; listPeakHours.append(li);
        });
      };
      loadReports();
    });
  </script>
</body>
</html>
